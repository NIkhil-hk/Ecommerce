<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firestore Data Submission</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, collection } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDXeFpHUeA3t8-h_zjQ6780wli8oyZ0hZE",
            authDomain: "ecom-23375.firebaseapp.com",
            databaseURL: "https://ecom-23375-default-rtdb.firebaseio.com",
            projectId: "ecom-23375",
            storageBucket: "ecom-23375.appspot.com",
            messagingSenderId: "79470020815",
            appId: "1:79470020815:web:39272f3397b04e54260fba",
            measurementId: "G-5GK70Z3NZL"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('dataForm').addEventListener('submit', async (e) => {
                e.preventDefault();

                const name = document.getElementById('name').value;
                const email = document.getElementById('email').value;
                const counterDocRef = doc(db, 'counters', 'userCounter');

                try {
                    // Get the current counter value
                    const counterSnap = await getDoc(counterDocRef);
                    let counter = 1;
                    if (counterSnap.exists()) {
                        counter = counterSnap.data().count + 1;
                    }

                    // Set the new document with a sequential ID
                    await setDoc(doc(db, 'users', counter.toString()), {
                        name: name,
                        email: email
                    });

                    // Update the counter value
                    await setDoc(counterDocRef, { count: counter });

                    alert('Data submitted successfully!');
                    document.getElementById('dataForm').reset();
                } catch (error) {
                    console.error('Error adding document: ', error);
                }
            });
        });
    </script>
</head>

<body>
    <h1>Submit Data to Firestore</h1>
    <form id="dataForm">
        <input type="text" id="name" placeholder="Name" required />
        <input type="email" id="email" placeholder="Email" required />
        <button type="submit">Submit</button>
    </form>
</body>

</html>